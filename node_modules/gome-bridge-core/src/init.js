/*
 * @Author: liuxiaocong 
 * @Date: 2017-07-19 20:36:56 
 * @Last Modified by: liuxiaocong
 * @Last Modified time: 2017-08-06 20:08:54
 */
// init
// import cordova from './cordova'
// window.cordova = cordova
// import channel from './channel'

// import platform from './platform'
// import utils from './utils'
var cordova = require('./cordova')
var channel = require('./channel')

var platform = require('./platform')
var utils = require('./utils')
let platformInitChannelsArray = [channel.onNativeReady];

function logUnfiredChannels(arr) {
    for (var i = 0; i < arr.length; ++i) {
        if (arr[i].state != 2) {
            console.log('Channel not fired: ' + arr[i].type);
        }
    }
}

window.setTimeout(function() {
    if (channel.onDeviceReady.state != 2) {
        console.log('deviceready has not fired after 5 seconds.');
        logUnfiredChannels(platformInitChannelsArray);
        logUnfiredChannels(channel.deviceReadyChannelsArray);
    }}, 5000);

// Register pause, resume and deviceready channels as events on document.
channel.onPause = cordova.addDocumentEventHandler('pause');
channel.onResume = cordova.addDocumentEventHandler('resume');
channel.onActivated = cordova.addDocumentEventHandler('activated');
channel.onDeviceReady = cordova.addStickyDocumentEventHandler('deviceready');
if (document.readyState == 'complete' || document.readyState == 'interactive') {
    channel.onDOMContentLoaded.fire();
} else {
    document.addEventListener('DOMContentLoaded',function() {
        channel.onDOMContentLoaded.fire();
    },false);
}
if (window._nativeReady) {
    channel.onNativeReady.fire();
}
platform.bootstrap && platform.bootstrap();
channel.join(function() {
    // Fire event to notify that all objects are created
    channel.onCordovaReady.fire();

    // Fire onDeviceReady event once page has fully loaded, all
    // constructors have run and cordova info has been received from native
    // side.
    channel.join(function() {
        require('./cordova').fireDocumentEvent('deviceready');
    },
    channel.deviceReadyChannelsArray);

},
platformInitChannelsArray);

