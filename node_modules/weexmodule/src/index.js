/*
 * @Author: zhouJun 
 * @Date: 2018-01-24 10:56:38 
 * @Last Modified by: zhouJun
 * @Last Modified time: 2018-02-07 15:53:12
 */

import Alert from './web/webModal.js'
import Loading from './web/webLoading.js'
import domain from './web/domain.js'
import GomeJSBridge from 'gome-bridge-core'
const stream = weex.requireModule('stream')
import env from './web/env.js'
/*
* 模态框
*/
weex.registerModule('DialogModule',{
        showDialog(params){
            new Alert({
                title:params.title,
                flag:params.cancelable,
                message:params.message,
                ok:params.ok,
                cancel:params.cancel,
                okTitle:params.okTitle,
                cancelTitle:params.cancelTitle,
                okCallback:params.okCallback,
                cancelCallback:params.cancelCallback
                // callback:callback
            }).show()
        }
})

/*
*  loading
*/
let load = null
weex.registerModule('LoadingModule', {
        showLoading(){
           if(env.isinapp){
            GomeJSBridge.showLoadingView()
           }else if(env.isinwap){
             load=new Loading()
             load.show()
            } 
        },
        hideLoading(){
            if(env.isinapp){
              GomeJSBridge.hideLoadingView()
            }else if(env.isinwap){
              load.destroy()
            }
        }
})

/*
*  页面跳转相关
*/
weex.registerModule('PageManagerModule', {  
    jump(url){
        window.location.href=url
    },
    initTitleBar(data){
       try{
        document.title=data.title
       }catch(err){
           
       }
    },
    getUrl(){
       return {
           result:1,
           data:{
            shareUrl:window.location.href,
            currentUrl:window.location.href
           }
        }
    }
})

/*
*  用户信息
*/ 
weex.registerModule('UserInfoModule', {
        getUserInfo(){

        },
        login(callback){
          //需要掉接口去判断当前是否登录
          stream.fetch({
            method:'GET',
            url:`${domain.domain}/active/CorsUserAgent`,
            type:'json'
          },result=>{
            if(result.data.islogin=='N'){
               window.location.href = `${domain.domain}/login.html`
            }else{
              callback('您已登录')
            }
          })
        }
})
/*
* 上报客户端埋点
*/
weex.registerModule('AnalyticsModule',{
  onResume(pid){

  },
  onEvent(eid,id,i){
    
  }
})





